<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link rel="stylesheet" href="__STATIC__/layui/css/layui.css">
	<link rel="stylesheet" href="__STATIC__/admin/css/admin.css"/>
	<link rel="stylesheet" href="__STATIC__/um/themes/default/css/umeditor.css">
	<style>
		.layui-form-label {width:120px}
		.layui-input-block {margin-left:160px}
	</style>
</head>
<body class="layui-view-body">
<div class="layui-content">
	<div class="layui-row" style="padding:15px">
		<div class="layui-card">
			<div class="layui-card-header">首页数据配置</div>
			<div class="layui-card-body" style="padding: 15px;">
				<form class="layui-form" action="" id="dataForm">
					<div class="layui-row layui-col-space10 layui-form-item">
						<div class="layui-col-lg6">
							<label class="layui-form-label">简介图</label>
							<div class="layui-input-block">
								<div class="layui-upload-drag uploadDiv">
									<i class="layui-icon"></i>
									<p>点击上传，建议大小470*470</p>
									<input type="hidden" name="brief_image" required lay-verify="required" lay-reqtext="请上传简介图" value="{$config.brief_image}">
								</div>
								<div class="layui-inline imgDiv122">
									<img class="showPath" src="{$config.brief_imageShow|default='__STATIC__/admin/images/default.png'}" style="width:100%;height:100%">
								</div>
							</div>
						</div>
						<div class="layui-col-lg6">
							<label class="layui-form-label">资质图片</label>
							<div class="layui-input-block">
								<div class="layui-upload-drag uploadDiv">
									<i class="layui-icon"></i>
									<p>点击上传，建议大小470*100</p>
									<input type="hidden" name="logos" required lay-verify="required" lay-reqtext="请上传资质证书" value="{$config.logos}">
								</div>
								<div class="layui-inline imgDiv122">
									<img class="showPath" data-id="img2" src="{$config.logosShow|default='__STATIC__/admin/images/default.png'}" style="width:100%;height:100%">
								</div>
							</div>
						</div>
					</div>
					<div class="layui-row layui-col-space10 layui-form-item">
						<div class="layui-col-lg6">
							<label class="layui-form-label">首页标题中文</label>
							<div class="layui-input-block">
								<input type="text" name="title_cn" value="{$config.title_cn}" lay-verify="required" autocomplete="off" class="layui-input layui-form-danger">
							</div>
						</div>
						<div class="layui-col-lg6">
							<label class="layui-form-label">首页标题英文</label>
							<div class="layui-input-block">
								<input type="text" name="title_en" value="{$config.title_en}" lay-verify="required" autocomplete="off" class="layui-input layui-form-danger">
							</div>
						</div>
					</div>
					<div class="layui-row layui-col-space10 layui-form-item">
						<div class="layui-col-lg6">
							<label class="layui-form-label">公司名称中文</label>
							<div class="layui-input-block">
								<input type="text" name="company_cn" value="{$config.company_cn}" lay-verify="required" autocomplete="off" class="layui-input layui-form-danger">
							</div>
						</div>
						<div class="layui-col-lg6">
							<label class="layui-form-label">公司名称英文</label>
							<div class="layui-input-block">
								<input type="text" name="company_en" value="{$config.company_en}" lay-verify="required" autocomplete="off" class="layui-input layui-form-danger">
							</div>
						</div>
					</div>

					<div class="layui-row layui-col-space10 layui-form-item">
						<div class="layui-col-lg6">
							<label class="layui-form-label">公司简介中文</label>
							<div class="layui-input-block">
								<textarea name="brief_cn" class="layui-textarea">{$config.brief_cn}</textarea>
							</div>
						</div>
						<div class="layui-col-lg6">
							<label class="layui-form-label">公司简介英文</label>
							<div class="layui-input-block">
								<textarea name="brief_en" class="layui-textarea">{$config.brief_en}</textarea>
							</div>
						</div>
					</div>
					<div class="layui-row layui-col-space10 layui-form-item">
						<div class="layui-col-lg3">
							<label class="layui-form-label">奖章数</label>
							<div class="layui-input-block">
								<input type="text" name="num_award" value="{$config.num_award}" lay-verify="required" autocomplete="off" class="layui-input layui-form-danger">
							</div>
						</div>
						<div class="layui-col-lg3">
							<label class="layui-form-label">公司数</label>
							<div class="layui-input-block">
								<input type="text" name="num_company" value="{$config.num_company}" lay-verify="required" autocomplete="off" class="layui-input layui-form-danger">
							</div>
						</div>
						<div class="layui-col-lg3">
							<label class="layui-form-label">百万欧元营业额</label>
							<div class="layui-input-block">
								<input type="text" name="num_turnover" value="{$config.num_turnover}" lay-verify="required" autocomplete="off" class="layui-input layui-form-danger">
							</div>
						</div>
						<div class="layui-col-lg3">
							<label class="layui-form-label">员工数</label>
							<div class="layui-input-block">
								<input type="text" name="num_employees" value="{$config.num_employees}" lay-verify="required" autocomplete="off" class="layui-input layui-form-danger">
							</div>
						</div>
					</div>

					<div class="layui-form-item" id="pics">
						<div class="layui-form-label">首页九宫格</div>
						<div class="layui-input-block" style="width: 70%;">
							<div class="layui-upload">
								<button type="button" class="layui-btn layui-btn-primary pull-left" id="slide-pc">选择多图，最多30张，大小建议为380*380以上</button>
								<div class="pic-more">
									<ul class="pic-more-upload-list" id="slide-pc-priview">
										{notempty name="$config.sudoku"}
										{foreach $config.sudoku as $v }
										<li class="item_img">
											<div class="operate">
												<i class="toleft layui-icon">《</i>
												<i class="toright layui-icon">》</i>
												<i class="close layui-icon">
													<img style="height: 32px;width: 32px;" src="__STATIC__/home/images/del.png">
												</i>
											</div>
											<img src="{$v.show}" class="img">
											<input type="hidden" name="sudoku[]" value="{$v.path}"/>
										</li>
										{/foreach}
										{/notempty}
									</ul>
								</div>
							</div>
						</div>
					</div>


					<div class="layui-form-item">
						<div class="layui-input-block">
							<div class="layui-footer">
								<input type="hidden" name="id" value="{$config.id|default=0}">
								<button class="layui-btn" lay-submit="" lay-filter="dataForm">立即提交</button>
							</div>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
<script src="__STATIC__/layui/layui.all.js"></script>
<script type="text/javascript" src="__STATIC__/um/third-party/jquery.min.js"></script>
<script type="text/javascript" src="__STATIC__/um/umeditor.config.js"></script>
<script type="text/javascript" src="__STATIC__/um/umeditor.js"></script>
<script type="text/javascript" src="__STATIC__/um/lang/zh-cn/zh-cn.js"></script>
<script type="text/javascript">
	layui.use(['layer', 'upload', 'form'], function () {
		var layer = layui.layer, $ = layui.$, upload = layui.upload, form = layui.form;
		upload.render({
			elem: '.uploadDiv'
			, exts: 'jpg|png|gif|bmp|jpeg|ico' //只允许上传压缩文件
			, accept: 'images' //普通文件
			, url: '/common/upload/image?t=' + new Date().getTime() //改成您自己的上传接口
			, done: function (res) {
				if (res.code == 1) {
					var _this = $(this.item);
					_this.find('input').val(res.data.path);
					_this.siblings('.imgDiv122').find('.showPath').attr("src", res.data.pathShow);
				} else {
					layer.msg('上传失败，请重试');
				}
			}
		});

		upload.render({
			elem: '#slide-pc',
			url: '/common/upload/image?t=' + new Date().getTime(),
			exts: 'jpg|png|gif|bmp|jpeg|ico',
			multiple: true,
			before: function (obj) {
				layer.msg('图片上传中，请稍后...', {
					icon: 16,
					shade: 0.01,
					time: 0
				})
			},
			done: function (res) {
				layer.close(layer.msg());//关闭上传提示窗口
				if (res.status == 0) {
					return layer.msg(res.message);
				}
				if ($("#slide-pc-priview > li").length >= 31) {
					layer.msg('九宫格最多上传30张图片');
					return false;
				}
				$('#slide-pc-priview').append('<li class="item_img"><div class="operate"><i class="toleft layui-icon">《</i><i class="toright layui-icon">》</i><i  class="close layui-icon"><img style="height: 32px;width: 32px;" src="__STATIC__/home/images/del.png"></i></div><img src="' + res.data.pathShow + '" class="img" ><input type="hidden" name="sudoku[]" value="' + res.data.path + '" /></li>');
			}
		});

		var umConfig = {
			'fontsize': [10, 11, 12, 14, 16, 18, 20, 24, 36, 48],
			'initialFrameWidth': '100%'
		};
		UM.getEditor('container-cn', umConfig);
		UM.getEditor('container-en', umConfig);

		//监听提交
		form.on('submit(dataForm)', function () {
			$.post('/admin/home/edit?t=' + new Date().getTime(), $('#dataForm').serialize(), function (res) {
				if (res.code == 1) {
					layer.closeAll();
					layer.msg('发布成功');
				} else {
					layer.msg('发布失败'.res.msg);
				}
			}, 'json');
			return false;
		});
	});
	//点击多图上传的X,删除当前的图片
	$("body").on("click", ".close", function () {
		$(this).closest("li").remove();
	});
	//多图上传点击<>左右移动图片
	$("body").on("click", ".pic-more ul li .toleft", function () {
		var li_index = $(this).closest("li").index();
		if (li_index >= 1) {
			$(this).closest("li").insertBefore($(this).closest("ul").find("li").eq(Number(li_index) - 1));
		}
	});
	$("body").on("click", ".pic-more ul li .toright", function () {
		var li_index = $(this).closest("li").index();
		$(this).closest("li").insertAfter($(this).closest("ul").find("li").eq(Number(li_index) + 1));
	});
</script>
</body>
</html>